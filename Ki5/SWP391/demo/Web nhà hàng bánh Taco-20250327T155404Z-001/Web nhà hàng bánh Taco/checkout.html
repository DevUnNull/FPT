<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thanh Toán - Tica's Tacos</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="styless.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #2c3e50, #2c3e50);
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo h1 {
            color: #8d0b0b;
            font-size: 28px;
            font-weight: 700;
        }

        main {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .payment-section, .summary-section {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .section-title {
            font-size: 22px;
            color: #8d0b0b;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .payment-methods {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
        }

        .payment-method {
            flex: 1;
            min-width: 120px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .payment-method:hover {
            border-color: #8d0b0b;
            transform: translateY(-3px);
        }

        .payment-method.active {
            border-color: #8d0b0b;
            background-color: rgba(141, 11, 11, 0.05);
        }

        .payment-method img {
            height: 40px;
            margin-bottom: 10px;
        }

        .payment-tabs {
            margin-top: 20px;
        }

        .tab-content {
            display: none;
            flex-direction: column;
            gap: 20px;
        }

        .tab-content.active {
            display: flex;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            border-color: #8d0b0b;
            outline: none;
        }

        .row {
            display: flex;
            gap: 15px;
        }

        .col {
            flex: 1;
        }

        .qr-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            border: 2px dashed #e0e0e0;
            border-radius: 10px;
            margin-top: 20px;
        }

        .qr-container {
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 15px;
        }

        .qr-container img {
            width: 150px;
            height: 150px;
        }

        .qr-info {
            text-align: center;
            color: #555;
        }

        .qr-methods {
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .bank-instructions {
            background-color: #fff8f0;
            border-left: 4px solid #8d0b0b;
            padding: 15px;
            margin-top: 20px;
            border-radius: 0 8px 8px 0;
        }

        .bank-instructions p {
            margin-bottom: 10px;
            color: #555;
        }

        .order-summary {
            margin-top: 20px;
        }

        .item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .item-name {
            display: flex;
            align-items: center;
        }

        .item-image {
            width: 50px;
            height: 50px;
            background-color: #f0f0f0;
            border-radius: 8px;
            margin-right: 15px;
            overflow: hidden;
        }

        .item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .price {
            font-weight: 600;
        }

        .subtotal, .shipping, .tax, .total {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .total {
            border-bottom: none;
            font-size: 20px;
            font-weight: 700;
            color: #8d0b0b;
        }

        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: #8d0b0b;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
            margin-top: 30px;
            text-align: center;
            text-decoration: none;
        }

        .btn:hover {
            background-color: #b30e0e;
            transform: translateY(-3px);
        }

        @media (max-width: 768px) {
            main {
                grid-template-columns: 1fr;
            }

            .row {
                flex-direction: column;
                gap: 10px;
            }

            .payment-methods {
                flex-direction: column;
            }

            .qr-container img {
                width: 120px;
                height: 120px;
            }
        }
    </style>
</head>
<body>
<header>
        <div class="logo">
            <a href="index.html">Tica's Tacos</a>
        </div>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
				<li><a href="reservation.html">Reservation</a></li>
                <li><a href="menu.html">Menu</a></li>              
                <li><a href="contact.html">Contact</a></li>
				<li><a href="cart.html">Cart (<span id="cart-count">0</span>)</a></li>
            </ul>
        </nav>
    </header>
    
        <main>
            <div class="payment-section">
                <h2 class="section-title">Phương thức thanh toán</h2>
                
                <div class="payment-methods">
                    <div class="payment-method active" data-tab="online-banking">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTL9Cpp1nDLbzIrK_-ljQsqJOGbytIiiDAgmQ&s" alt="Banking">
                        <div>Online banking</div>
                    </div>
                    <div class="payment-method" data-tab="credit-card">
                        <img src="https://www.visa.com.vn/dam/VCOM/regional/ap/vietnam/global-elements/images/vn-visa-platinum-card-498x280.png" alt="Card">
                        <div>Credit card</div>
                    </div>
                </div>

                <div class="payment-tabs">
                    <!-- Online Banking Tab -->
                    <div class="tab-content active" id="online-banking">
                        <div class="qr-section">
                            <h3>Scan QR code to pay</h3>
                            <div class="qr-methods">
                                <div class="qr-container">
                                    <img src="banners/vietinbank.jpg" alt="Mã QR VietinBank">
                                    
                                </div>
                                <div class="qr-container">
                                    <img src="banners/momo.jpg" alt="Mã QR MoMo">
                                    
                                </div>
                            </div>
                        </div>

                        <div class="bank-instructions">
                            <h3>Payment instructions</h3>
                            <p>1.Open your banking or MoMo app and scan the QR code.</p>
                            <p>2. Enter exact amount: <strong id="total-to-pay">0 VNĐ</strong></p>
                            <p>3. Please clearly state the transfer content as: <strong>ORDER_[Order code]</strong></p>
                            <p>4. Confirm and complete payment.</p>
                        </div>
                    </div>

                    <!-- Credit Card Tab -->
                    <div class="tab-content" id="credit-card">
                        <form>
                            <div class="form-group">
                                <label for="card-number">Card number</label>
                                <input type="text" class="form-control" id="card-number" placeholder="Enter card number">
                            </div>
                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <label for="expiry-date">Expiration date</label>
                                        <input type="text" class="form-control" id="expiry-date" placeholder="MM/YY">
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="form-group">
                                        <label for="cvv">CVV</label>
                                        <input type="text" class="form-control" id="cvv" placeholder="123">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="card-holder">Cardholder name</label>
                                <input type="text" class="form-control" id="card-holder" placeholder="Nguyen Van A">
                            </div>
                        </form>
                    </div>
                </div>

                <form id="delivery-form">
                    <h3 class="section-title">Delivery information</h3>
                    <div class="form-group">
                        <label for="name">Full name</label>
                        <input type="text" class="form-control" id="name" placeholder="Enter your full name" required>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="form-group">
                                <label for="phone">Phone number</label>
                                <input type="tel" class="form-control" id="phone" placeholder="Enter phone number" required>
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="email" class="form-control" id="email" placeholder="Enter email" required>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="address">Shipping address</label>
                        <input type="text" class="form-control" id="address" placeholder="Enter address" required>
                    </div>
                    <div class="form-group">
                        <label>Distance: <span id="distance">0 km</span></label>
                        <p>Shipping fee: <span id="shipping-fee">0 VNĐ</span></p>
                    </div>
                </form>
            </div>

            <div class="summary-section">
                <h2 class="section-title">Order Summary</h2>
                <div class="order-summary" id="order-summary">
                    <!-- Danh sách món sẽ được thêm bằng JavaScript -->
                </div>
                <div class="subtotal">
                    <div>Provisional</div>
                    <div id="subtotal">0 VNĐ</div>
                </div>
                <div class="shipping">
                    <div>Shipping fee</div>
                    <div id="shipping">0 VNĐ</div>
                </div>
                <div class="total">
                    <div>Total</div>
                    <div id="total">0 VNĐ</div>
                </div>
                <div class="form-group">
                    <label for="note">Order notes</label>
                    <textarea class="form-control" id="note" rows="3" placeholder="Notes on dish or delivery, e.g. less spicy, no onions..."></textarea>
                </div>
                <button class="btn" onclick="placeOrder()">ORDER NOW</button>
            </div>
        </main>

    <script>
        // Tọa độ cố định của nhà hàng: 136 Phó Đức Chính, Trúc Bạch, Ba Đình, Hà Nội
        const restaurantLocation = { lat: 21.0467, lng: 105.8366 };

        // Danh sách giá (đồng bộ với cart.html)
        const menuPrices = {
            "Taco al Pastor": 35000,
            "Taco de Carnitas": 40000,
            "Taco de Pescado": 48000,
            "Taco de Barbacoa": 45000,
            "Taco de Birria": 50000,
            "Taco de Asada": 42000,
            "Taco de Camarón": 55000,
            "Taco de Lengua": 50000,
            "Taco de Chorizo": 40000,
            "Taco de Nopales": 38000,
            "Burrito de Carne Asada": 120000,
            "Burrito de Pollo": 110000,
            "Burrito de Barbacoa": 130000,
            "Burrito de Chorizo y Papas": 115000,
            "Burrito Vegetariano": 100000,
            "Burrito de Camarones": 135000,
            "Burrito de Carnitas": 125000,
            "Burrito de Frijoles y Queso": 90000,
            "Burrito de Huevo": 95000,
            "Burrito Supremo": 150000,
            "Tamales Verdes": 30000,
            "Tamales Rojos": 35000,
            "Tamales de Rajas": 32000,
            "Tamales de Dulce": 28000,
            "Tamales de Elote": 29000,
            "Tamales Oaxaqueños": 40000,
            "Tamales de Cambray": 38000,
            "Tamales de Chicharrón": 36000,
            "Tamales de Frijoles": 30000,
            "Tamales de Chocolate": 33000,
            "Chiles en Nogada": 200000,
            "Chiles en Nogada de Pollo": 190000,
            "Chiles en Nogada Vegetariano": 175000,
            "Chiles en Nogada con Queso": 185000,
            "Chiles en Nogada con Frutas": 195000,
            "Chiles en Nogada con Nuez Pecana": 205000,
            "Chiles en Nogada con Mole": 210000,
            "Chiles en Nogada de Pavo": 220000,
            "Chiles en Nogada con Amaranto": 190000,
            "Pozole": 110000,
            "Menudo": 120000,
            "Caldo de Res": 115000,
            "Sopa de Tortilla": 100000,
            "Caldo de Pollo": 105000,
            "Birria": 130000,
            "Mole Poblano": 140000,
            "Cochinita Pibil": 135000,
            "Carne Guisada": 125000,
            "Albondigas": 120000,
            "Guacamole": 50000,
            "Queso Fundido": 85000,
            "Ceviche": 100000,
            "Tostadas": 65000,
            "Elote": 45000,
            "Pico de Gallo": 40000,
            "Totopos con Salsa": 35000,
            "Esquites": 40000,
            "Tlacoyos": 55000,
            "Sopes": 60000,
            "Horchata": 35000,
            "Agua Fresca": 30000,
            "Margarita": 80000,
            "Michelada": 60000,
            "Coca Cola": 25000,
            "Sprite": 25000
        };

        // Công thức Haversine để tính khoảng cách đường thẳng (km)
        function haversineDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Bán kính Trái Đất (km)
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c; // Khoảng cách (km)
        }

        // Tính khoảng cách và phí vận chuyển
        async function calculateDistance() {
            const address = document.getElementById('address').value;
            if (!address) return;

            // Sử dụng Nominatim API (OpenStreetMap) để chuyển địa chỉ thành tọa độ
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}`);
                const data = await response.json();

                if (data.length === 0) {
                    alert('Không thể tìm địa chỉ. Vui lòng nhập lại.');
                    return;
                }

                const destination = {
                    lat: parseFloat(data[0].lat),
                    lng: parseFloat(data[0].lon)
                };

                // Tính khoảng cách đường thẳng
                const distance = haversineDistance(
                    restaurantLocation.lat,
                    restaurantLocation.lng,
                    destination.lat,
                    destination.lng
                );

                document.getElementById('distance').textContent = distance.toFixed(2) + ' km';

                let shippingFee = 0;
                if (distance > 3) {
                    shippingFee = (distance - 3) * 10000; // 10k cho mỗi km vượt quá 3km
                }
                document.getElementById('shipping-fee').textContent = shippingFee.toLocaleString('vi-VN') + ' VNĐ';
                document.getElementById('shipping').textContent = shippingFee.toLocaleString('vi-VN') + ' VNĐ';

                // Cập nhật tổng tiền
                const subtotal = parseInt(document.getElementById('subtotal').textContent.replace(/[^0-9]/g, ''));
                const total = subtotal + shippingFee;
                document.getElementById('total').textContent = total.toLocaleString('vi-VN') + ' VNĐ';
                document.getElementById('total-to-pay').textContent = total.toLocaleString('vi-VN') + ' VNĐ';
            } catch (error) {
                alert('Có lỗi xảy ra khi tính khoảng cách. Vui lòng thử lại.');
            }
        }

        // Hiển thị danh sách món đã chọn
        const checkoutItems = JSON.parse(localStorage.getItem('checkoutItems')) || [];
        const orderSummary = document.getElementById('order-summary');
        let subtotal = 0;

        checkoutItems.forEach(item => {
            const price = menuPrices[item.name];
            subtotal += price;

            const itemHtml = `
                <div class="item">
                    <div class="item-name">
                        <div class="item-image">
                            <img src="${item.img}" alt="${item.name}">
                        </div>
                        <div>
                            <div>${item.name}</div>
                            <div style="color: #777; font-size: 14px;">SL: 1</div>
                        </div>
                    </div>
                    <div class="price">${price.toLocaleString('vi-VN')}₫</div>
                </div>
            `;
            orderSummary.innerHTML += itemHtml;
        });

        document.getElementById('subtotal').textContent = subtotal.toLocaleString('vi-VN') + ' VNĐ';
        document.getElementById('total').textContent = subtotal.toLocaleString('vi-VN') + ' VNĐ';
        document.getElementById('total-to-pay').textContent = subtotal.toLocaleString('vi-VN') + ' VNĐ';

        // Xử lý tab thanh toán
        const paymentMethods = document.querySelectorAll('.payment-method');
        const tabContents = document.querySelectorAll('.tab-content');

        paymentMethods.forEach(method => {
            method.addEventListener('click', () => {
                paymentMethods.forEach(m => m.classList.remove('active'));
                tabContents.forEach(t => t.classList.remove('active'));

                method.classList.add('active');
                document.getElementById(method.dataset.tab).classList.add('active');
            });
        });

        // Lắng nghe sự kiện thay đổi địa chỉ
        document.getElementById('address').addEventListener('change', calculateDistance);

        // Xử lý đặt hàng
        function placeOrder() {
            const form = document.getElementById('delivery-form');
            if (!form.checkValidity()) {
                alert('Vui lòng điền đầy đủ thông tin giao hàng!');
                return;
            }

            alert('Đặt hàng thành công! Cảm ơn bạn đã mua hàng tại Tica\'s Tacos.');
            localStorage.removeItem('checkoutItems'); // Xóa dữ liệu sau khi đặt hàng
            localStorage.removeItem('cart'); // Xóa giỏ hàng sau khi đặt hàng
            window.location.href = 'index.html'; // Chuyển về trang chủ
        }
    </script>
</body>
</html>